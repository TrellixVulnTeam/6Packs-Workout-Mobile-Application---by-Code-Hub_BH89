{"ast":null,"code":"import { Validators } from '@angular/forms';\nimport Swal from 'sweetalert2';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"@ionic/angular\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"../services/user.service\";\nimport * as i5 from \"../services/data.service\";\nimport * as i6 from \"@angular/common\";\n\nfunction ChangePasswordModalPage_div_13_ng_container_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"small\", 9);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const error_r2 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(error_r2.message);\n  }\n}\n\nfunction ChangePasswordModalPage_div_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtemplate(1, ChangePasswordModalPage_div_13_ng_container_1_Template, 3, 1, \"ng-container\", 8);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", (ctx_r0.changePassForm.controls[\"account_password\"].errors == null ? null : ctx_r0.changePassForm.controls[\"account_password\"].errors.required) && ctx_r0.changePassForm.controls[\"account_password\"].touched);\n  }\n}\n\nfunction ChangePasswordModalPage_div_18_ng_container_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"small\", 9);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementContainerEnd();\n  }\n\n  if (rf & 2) {\n    const error_r5 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(error_r5.message);\n  }\n}\n\nfunction ChangePasswordModalPage_div_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtemplate(1, ChangePasswordModalPage_div_18_ng_container_1_Template, 3, 1, \"ng-container\", 8);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngIf\", (ctx_r1.changePassForm.controls[\"account_password_confirmation\"].errors == null ? null : ctx_r1.changePassForm.controls[\"account_password_confirmation\"].errors.required) && ctx_r1.changePassForm.controls[\"account_password_confirmation\"].touched);\n  }\n}\n\nexport let ChangePasswordModalPage = /*#__PURE__*/(() => {\n  class ChangePasswordModalPage {\n    constructor(fb, mdController, router, userService, dataService) {\n      this.fb = fb;\n      this.mdController = mdController;\n      this.router = router;\n      this.userService = userService;\n      this.dataService = dataService;\n      this.errormsgs = {\n        account_password: [{\n          type: 'required',\n          message: 'Enter your new password.'\n        }, {\n          type: 'pattern',\n          message: 'Must contains special characters and digits.'\n        }],\n        account_password_confirmation: [{\n          type: 'required',\n          message: 'Enter your new password.'\n        }, {\n          type: 'MustMatch',\n          message: 'New Password does not match.'\n        }]\n      };\n      this.submitted = false;\n    }\n\n    closeModal() {\n      this.mdController.dismiss();\n      this.router.navigate(['/old-pass-entry']);\n    }\n\n    ionViewDidEnter() {\n      this.userObj = this.userService.getUser();\n      console.log(this.userObj);\n      this.account_id = this.userObj.userId;\n      this.account_password = this.userObj.userPassword;\n      this.old_password = this.userObj.userPassword;\n      console.log(this.old_password);\n    }\n\n    ngOnInit() {\n      this.changePassForm = this.fb.group({\n        account_password: ['', [Validators.required, Validators.minLength(6), Validators.pattern('^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!@$ %^&*-]).{8,}$')]],\n        account_password_confirmation: ['', [Validators.required]]\n      }, {\n        validators: this.MustMatch('account_password', 'account_password_confirmation')\n      });\n    }\n\n    get f() {\n      return this.changePassForm.controls;\n    }\n\n    MustMatch(controlName, matchingControlName) {\n      return formGroup => {\n        const control = formGroup.controls[controlName];\n        const matchingControl = formGroup.controls[matchingControlName];\n\n        if (matchingControl.errors && !matchingControl.errors.mustMatch) {\n          return;\n        }\n\n        if (control.value !== matchingControl.value) {\n          matchingControl.setErrors({\n            mustMatch: true\n          });\n        } else {\n          matchingControl.setErrors(null);\n        }\n      };\n    }\n\n    changePassword(account_id, account_password) {\n      account_password = this.changePassForm.get('account_password').value;\n\n      if (this.changePassForm.valid) {\n        this.dataService.request('updatepassword', {\n          account_id,\n          account_password\n        }).subscribe(res => {\n          if (res.data) {\n            Swal.fire({\n              icon: 'success',\n              title: 'Password Changed!',\n              text: 'Password change successfully. Please re-login your account.',\n              showConfirmButton: true,\n              confirmButtonText: 'Login'\n            }).then(result => {\n              if (result.isConfirmed) {\n                this.changePassForm.reset();\n                this.userService.setLoggedOut();\n                this.userService.clearUser();\n                this.router.navigate(['/login']);\n              }\n            });\n          } else if (res.error) {\n            Swal.fire({\n              icon: 'error',\n              title: 'Failed!',\n              text: 'Please try again.',\n              showConfirmButton: true,\n              confirmButtonText: 'Okay'\n            }).then(result => {\n              if (result.isConfirmed) {\n                this.changePassForm.reset();\n              }\n            });\n          }\n        });\n      }\n    }\n\n  }\n\n  ChangePasswordModalPage.ɵfac = function ChangePasswordModalPage_Factory(t) {\n    return new (t || ChangePasswordModalPage)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.ModalController), i0.ɵɵdirectiveInject(i3.Router), i0.ɵɵdirectiveInject(i4.UserService), i0.ɵɵdirectiveInject(i5.DataService));\n  };\n\n  ChangePasswordModalPage.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: ChangePasswordModalPage,\n    selectors: [[\"app-change-password-modal\"]],\n    decls: 21,\n    vars: 4,\n    consts: [[\"slot\", \"start\"], [\"icon\", \"arrow-back-outline\", \"defaultHref\", \"/old-pass-entry\"], [\"ngNativeValidate\", \"\", 3, \"formGroup\", \"submit\"], [\"position\", \"floating\"], [\"type\", \"password\", \"formControlName\", \"account_password\"], [4, \"ngFor\", \"ngForOf\"], [\"type\", \"password\", \"formControlName\", \"account_password_confirmation\"], [\"type\", \"submit\", \"mode\", \"ios\", \"color\", \"success\", \"expand\", \"block\", 3, \"click\"], [4, \"ngIf\"], [1, \"error-message\"]],\n    template: function ChangePasswordModalPage_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"ion-header\");\n        i0.ɵɵelementStart(1, \"ion-toolbar\");\n        i0.ɵɵelementStart(2, \"ion-buttons\", 0);\n        i0.ɵɵelement(3, \"ion-back-button\", 1);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(4, \"ion-title\");\n        i0.ɵɵtext(5, \"Change password\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(6, \"ion-content\");\n        i0.ɵɵelementStart(7, \"form\", 2);\n        i0.ɵɵlistener(\"submit\", function ChangePasswordModalPage_Template_form_submit_7_listener() {\n          return ctx.changePassword(ctx.account_id, ctx.account_password);\n        });\n        i0.ɵɵelementStart(8, \"ion-list\");\n        i0.ɵɵelementStart(9, \"ion-item\");\n        i0.ɵɵelementStart(10, \"ion-label\", 3);\n        i0.ɵɵtext(11, \"New password\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(12, \"ion-input\", 4);\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(13, ChangePasswordModalPage_div_13_Template, 2, 1, \"div\", 5);\n        i0.ɵɵelementStart(14, \"ion-item\");\n        i0.ɵɵelementStart(15, \"ion-label\", 3);\n        i0.ɵɵtext(16, \"Confirm new password\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(17, \"ion-input\", 6);\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(18, ChangePasswordModalPage_div_18_Template, 2, 1, \"div\", 5);\n        i0.ɵɵelementStart(19, \"ion-button\", 7);\n        i0.ɵɵlistener(\"click\", function ChangePasswordModalPage_Template_ion_button_click_19_listener() {\n          return ctx.changePassword(ctx.account_id, ctx.account_password);\n        });\n        i0.ɵɵtext(20, \"Save New Password\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(7);\n        i0.ɵɵproperty(\"formGroup\", ctx.changePassForm);\n        i0.ɵɵadvance(6);\n        i0.ɵɵproperty(\"ngForOf\", ctx.errormsgs.account_password);\n        i0.ɵɵadvance(5);\n        i0.ɵɵproperty(\"ngForOf\", ctx.errormsgs.account_password_confirmation);\n        i0.ɵɵadvance(1);\n        i0.ɵɵattribute(\"disabled\", !ctx.changePassForm.valid);\n      }\n    },\n    directives: [i2.IonHeader, i2.IonToolbar, i2.IonButtons, i2.IonBackButton, i2.IonBackButtonDelegate, i2.IonTitle, i2.IonContent, i1.NgControlStatusGroup, i1.FormGroupDirective, i2.IonList, i2.IonItem, i2.IonLabel, i2.IonInput, i2.TextValueAccessor, i1.NgControlStatus, i1.FormControlName, i6.NgForOf, i2.IonButton, i6.NgIf],\n    styles: [\"ion-toolbar[_ngcontent-%COMP%]{--ion-font-family:\\\"barlow-font-lighter\\\"}a[_ngcontent-%COMP%]{float:left;position:relative;margin-left:10px}a[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:22px}.error-message[_ngcontent-%COMP%]{color:var(--ion-color-danger);margin-left:5px;font-size:14px;text-align:left}p[_ngcontent-%COMP%]{justify-content:left;text-align:justify;margin:15px}ion-button[_ngcontent-%COMP%]{margin-left:15px;margin-right:15px;margin-bottom:7px}\"]\n  });\n  return ChangePasswordModalPage;\n})();","map":null,"metadata":{},"sourceType":"module"}